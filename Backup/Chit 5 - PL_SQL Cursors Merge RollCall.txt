Chit 5 — PL/SQL cursors merge N_RollCall → O_RollCall


Tables:
- N_RollCall(rollno, name, ...)
- O_RollCall(rollno, name, ...)


PL/SQL Block with Cursor:


DECLARE
    CURSOR c_new(p_rollno NUMBER) IS
        SELECT rollno, name FROM N_RollCall WHERE rollno = p_rollno;
    TYPE t_rec IS RECORD (
        rollno N_RollCall.rollno%TYPE,
        name N_RollCall.name%TYPE
    );
    v_rec t_rec;
BEGIN
    FOR r IN (SELECT rollno, name FROM N_RollCall) LOOP
        -- Check if exists in O_RollCall
        BEGIN
            SELECT 1 INTO v_rec.rollno
            FROM O_RollCall
            WHERE rollno = r.rollno;
            -- if found, skip
            NULL;
        EXCEPTION
            WHEN NO_DATA_FOUND THEN
                -- insert into O_RollCall
                INSERT INTO O_RollCall (rollno, name)
                VALUES (r.rollno, r.name);
        END;
    END LOOP;
    COMMIT;
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/


Alternate using MERGE (Oracle):


MERGE INTO O_RollCall o
USING N_RollCall n
ON (o.rollno = n.rollno)
WHEN NOT MATCHED THEN
    INSERT (rollno, name)
    VALUES (n.rollno, n.name);